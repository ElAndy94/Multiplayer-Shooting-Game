<div id="signDiv">   <!-- Signing in Div -->
    Username: <input id="signDiv-username" type="text"></input><br>  <!--input username box -->
    Password: <input id="signDiv-password" type="password"></input> <!--input password box -->
    <button id="signDiv-signIn">Sign In</button> <!-- Sign in button -->
    <button id="signDiv-signUp">Sign Up</button> <!-- Sign UP in button -->
</div>
<script src="/socket.io/socket.io.js"></script>
<body onload="loadSound();">

  <div id="gameDiv" style="display:none;">   <!-- Game Div, display none, until logged in! -->
      <canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"> <!-- creating canvas -->
      </canvas> 

  </div>
    </body>
    <!-- <script type='text/javascript'src="/client/script.js"></script> -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"> <!--Mobile functionality -->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script> <!--Mobile functionality -->
    <script src="https://code.createjs.com/soundjs-0.6.2.min.js"></script>

<script>
    var WIDTH = 500;
	var HEIGHT = 500;
    var socket = io(); // socket io
    var soundID = "Thunder"; //sound

    //signIn/Out
    var signDiv = document.getElementById('signDiv'); //<!-- Sign in Div -->
    var signDivUsername = document.getElementById('signDiv-username'); //<!-- username element -->
    var signDivSignIn = document.getElementById('signDiv-signIn'); //<!-- sign in element -->
    var signDivPassword = document.getElementById('signDiv-password'); //<!-- password element -->
    var signDivUp = document.getElementById('signDiv-signUp'); //<!-- password element -->

    signDivSignIn.onclick = function(){  //<!-- clicking the sign in button does this function -->
        socket.emit('LogIn',{username:signDivUsername.value,password:signDivPassword.value}); //<!-- emits username + password to server -->
        }

    signDivUp.onclick = function(){  //<!-- clicking the sign in button does this function -->
        socket.emit('signUp',{username:signDivUsername.value,password:signDivPassword.value}); //<!-- emits username + password to server -->
        }

    socket.on('LogInResponse',function(data){  // Sign in Response function
        if(data.success){
            signDiv.style.display = 'none'; //display none until the logging has been passed
            gameDiv.style.display = 'inline-block'; //when log in has been passed then it will display the gameDiv
        }  else
            alert("Sign in was unsuccessful!"); //if password or username is wrong, you get this alart
    });

    socket.on('signPlayerRes',function(data){  // Sign UP*** in Response function
        if(data.success){
            alert("Sign up was successful!");
        }  else
            alert("Sign in was unsuccessful!"); // Not signing up
    });


//game

  function loadSound () {
  createjs.Sound.registerSound("/client/shot.mp3", soundID);
  }
  
  function playSound () {
  createjs.Sound.play(soundID);
  }

  var ctx = document.getElementById('ctx').getContext('2d');
  ctx.font = '30px Arial';

  var Img = {}; //creats image array
  Img.bullet = new Image(); 
  Img.bullet.src = '/client/images/bullet.png'; //loads the bullet
  Img.player = new Image(); 
  Img.player.src = '/client/images/littleman.png'; //loads the player
  Img.grass = new Image(); 
  Img.grass.src = '/client/images/grasses.png'; //loads the background

var Player = function(initPack){
		var self = {};
		self.id = initPack.id;
		self.number = initPack.number;
		self.x = initPack.x;
		self.y = initPack.y;
		self.healthPoints = initPack.healthPoints;
		self.maxHealthPoints = initPack.maxHealthPoints;
		self.score = initPack.score;
		
		self.draw = function(){	
            var x = self.x - Player.list[selfId].x + WIDTH/2;
            var y = self.y - Player.list[selfId].y + WIDTH/2;

            var hpWidth = 30 * self.healthPoints / self.maxHealthPoints;
            ctx.fillStyle = 'red';
            ctx.fillRect(x - hpWidth/2,y - 40,hpWidth,4);
            
            var width = Img.player.width/20;
            var height = Img.player.width/20;

            ctx.drawImage(Img.player,
            0,0,Img.player.width,Img.player.height,
            x-width/2,y-height/2,width,height);
            
            // ctx.fillRect(self.x,self.y,10,10);
			
		}
		
		Player.list[self.id] = self;
		
		
		return self;
	}
	Player.list = {};

		
	var Bullet = function(initPack){
		var self = {};
		self.id = initPack.id;
		self.x = initPack.x;
		self.y = initPack.y;
		
		self.draw = function(){
            var width = Img.bullet.width/10;
            var height = Img.bullet.width/10;

            var x = self.x - Player.list[selfId].x + WIDTH/2;
            var y = self.y - Player.list[selfId].y + WIDTH/2;

            ctx.drawImage(Img.bullet,0,0,Img.bullet.width,Img.bullet.height,
            x-width/2,y-height/2,width,height);
			// ctx.fillRect(self.x-5,self.y-5,10,10);
		}
		
		Bullet.list[self.id] = self;		
		return self;
	}
	Bullet.list = {};


    var selfId = null;

    Player.list[selfId];
  //player and bullet info big pack
socket.on('init',function(data){
    if(data.selfId)
        selfId = data.selfId;

    for(var i = 0; i < data.player.length; i++) //player
        new Player(data.player[i]);

    for(var i = 0; i < data.bullet.length; i++) //bullet
        new Bullet(data.bullet[i]);
  });

// update player and bullet location - id
socket.on('update',function(data){
    for(var i = 0; i < data.player.length; i++){
        var pack = data.player[i];
        var ple = Player.list[pack.id];
        if(ple) {
                if(pack.x !== undefined)
                   ple.x = pack.x;
                if(pack.y !== undefined)
                   ple.y = pack.y;
                if(pack.heatlhPoints !== undefined)
                   ple.healthPoints = pack.healthPoints;
                if(pack.score !== undefined)
                   ple.score = pack.score;
        }
    }

    for(var i = 0; i < data.bullet.length; i++){
        var pack = data.bullet[i];
        var bul = Bullet.list[data.bullet[i].id];
        if(bul) {
                if(pack.x !== undefined)
                   bul.x = pack.x;
                if(pack.y !== undefined)
                   bul.y = pack.y;
        }
    }
});
    
//remove player/bullet
socket.on('remove',function(data){
    for(var i = 0; i < data.player.length; i++){
        delete Player.list[data.player[i]];
    }
    for(var i = 0; i < data.bullet.length; i++){
        delete Bullet.list[data.bullet[i]];
    }
});


//draw

setInterval(function(){
    if(!selfId)
        return;

        ctx.clearRect(0,0,500,500);
        drawGrass();
        theScore();
		for(var i in Player.list)
			Player.list[i].draw();
		for(var i in Bullet.list)
			Bullet.list[i].draw();
    },40);
    
var theScore = function(){
    ctx.fillStyle = 'black';
    ctx.fillText(Player.list[selfId].score,0,30);
}

var drawGrass = function(){
    var x = WIDTH/2 - Player.list[selfId].x;
    var y = WIDTH/2 - Player.list[selfId].y;
    ctx.drawImage(Img.grass,x,y);
		// ctx.drawImage(Img.grass,1,1,500,500); //draws the grass in that area
	}


  document.onkeydown = function(event){ //keyboard controls
      if(event.keyCode === 39) //right arrow
          socket.emit('movementKey' ,{inputId:'right',state:true});
      if(event.keyCode === 40) //down arrow
          socket.emit('movementKey' ,{inputId:'down',state:true});
      if(event.keyCode === 37) //left arrow
          socket.emit('movementKey' ,{inputId:'left',state:true});
      if(event.keyCode === 38) //up arrow
          socket.emit('movementKey' ,{inputId:'up',state:true});
  }

  document.onkeyup = function(event){
      if(event.keyCode === 39) //right arrow
          socket.emit('movementKey' ,{inputId:'right',state:false});
      if(event.keyCode === 40) //down arrow
          socket.emit('movementKey' ,{inputId:'down',state:false});
      if(event.keyCode === 37) //left arrow
          socket.emit('movementKey' ,{inputId:'left',state:false});
      if(event.keyCode === 38) //up arrow
          socket.emit('movementKey' ,{inputId:'up',state:false});
   }


   document.onmousedown = function(event){
     socket.emit('movementKey',{inputId:'attack',state:true}); //mouse down to attack (click)*

     if(event.target.attributes["id"].value !== "ctx"){ // only plays shot sound once im logged in, had clickdown sound when pressing login!*
         return;
     } else {
         playSound(); //plays the shot sound
     }
   }

   document.onmouseup = function(event){
     socket.emit('movementKey',{inputId:'attack',state:false}); //when not attacking, (unlicked)*
   }

   document.onmousemove = function(event){
      var x = -250 + event.clientX - 8;  //500 being the whole screen
      var y = -250 + event.clientY - 8;
      var angle = Math.atan2(y,x) / Math.PI * 180;
      socket.emit('movementKey',{inputId:'mouseAngle',state:angle});
   }

  </script>
